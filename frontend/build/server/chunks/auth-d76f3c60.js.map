{"version":3,"file":"auth-d76f3c60.js","sources":["../../../.svelte-kit/adapter-node/chunks/auth.js"],"sourcesContent":["import { g as goto } from \"./navigation.js\";\nimport { f as PathRefresh, a as PathAuth } from \"./paths.js\";\nimport { e as error } from \"./index.js\";\nasync function redirector(res) {\n  if (!res.ok) {\n    if (res.status == 403) {\n      goto(\"/verification\");\n    } else if (res.status == 401) {\n      goto(\"/signin\");\n    } else if (res.status == 404 || res.status == 500) {\n      throw error(res.status);\n    }\n  }\n}\nasync function refresher() {\n  let formData = new FormData();\n  formData.append(\"token\", localStorage.getItem(\"SID\"));\n  let res = await (await fetch(PathRefresh(), {\n    method: \"POST\",\n    body: formData\n  })).json();\n  if (res.status == \"success\") {\n    localStorage.setItem(\"SID\", `${res.token}`);\n  }\n}\nasync function ProfileData() {\n  let authRes = await fetch(PathAuth(), {\n    headers: {\n      Authorization: `${localStorage.getItem(\"SID\")}`\n    }\n  });\n  if (authRes.ok) {\n    let authResponse = await authRes.json();\n    if (authResponse?.data?.user?.verified == false) {\n      goto(\"/verification\");\n      return;\n    }\n    if (authResponse?.data?.user?.roles[0]?.name == \"parent\" && window.location.href.includes(\"admin\")) {\n      goto(\"/\", { replaceState: true });\n      return;\n    }\n    return authResponse;\n  } else {\n    goto(\"/signin\");\n  }\n  return {};\n}\nexport {\n  ProfileData as P,\n  redirector as a,\n  refresher as r\n};\n"],"names":[],"mappings":";;;;AAGA,eAAe,UAAU,CAAC,GAAG,EAAE;AAC/B,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE;AACf,IAAI,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,EAAE;AAC3B,MAAM,IAAI,CAAC,eAAe,CAAC,CAAC;AAC5B,KAAK,MAAM,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,EAAE;AAClC,MAAM,IAAI,CAAC,SAAS,CAAC,CAAC;AACtB,KAAK,MAAM,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,EAAE;AACvD,MAAM,MAAM,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAC9B,KAAK;AACL,GAAG;AACH,CAAC;AACD,eAAe,SAAS,GAAG;AAC3B,EAAE,IAAI,QAAQ,GAAG,IAAI,QAAQ,EAAE,CAAC;AAChC,EAAE,QAAQ,CAAC,MAAM,CAAC,OAAO,EAAE,YAAY,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;AACxD,EAAE,IAAI,GAAG,GAAG,MAAM,CAAC,MAAM,KAAK,CAAC,WAAW,EAAE,EAAE;AAC9C,IAAI,MAAM,EAAE,MAAM;AAClB,IAAI,IAAI,EAAE,QAAQ;AAClB,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC;AACb,EAAE,IAAI,GAAG,CAAC,MAAM,IAAI,SAAS,EAAE;AAC/B,IAAI,YAAY,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAChD,GAAG;AACH,CAAC;AACD,eAAe,WAAW,GAAG;AAC7B,EAAE,IAAI,OAAO,GAAG,MAAM,KAAK,CAAC,QAAQ,EAAE,EAAE;AACxC,IAAI,OAAO,EAAE;AACb,MAAM,aAAa,EAAE,CAAC,EAAE,YAAY,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;AACrD,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,OAAO,CAAC,EAAE,EAAE;AAClB,IAAI,IAAI,YAAY,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AAC5C,IAAI,IAAI,YAAY,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,IAAI,KAAK,EAAE;AACrD,MAAM,IAAI,CAAC,eAAe,CAAC,CAAC;AAC5B,MAAM,OAAO;AACb,KAAK;AACL,IAAI,IAAI,YAAY,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,IAAI,QAAQ,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;AACxG,MAAM,IAAI,CAAC,GAAG,EAAE,EAAE,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC;AACxC,MAAM,OAAO;AACb,KAAK;AACL,IAAI,OAAO,YAAY,CAAC;AACxB,GAAG,MAAM;AACT,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC;AACpB,GAAG;AACH,EAAE,OAAO,EAAE,CAAC;AACZ;;;;"}