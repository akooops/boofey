{"version":3,"file":"_page.svelte-bbe7d725.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(app)/admin/canteens/_canteenId_/qr-exit/_page.svelte.js"],"sourcesContent":["import { c as create_ssr_component, g as createEventDispatcher, e as escape, a as subscribe, d as add_attribute, b as each, v as validate_component } from \"../../../../../../../chunks/ssr.js\";\nimport \"qr-scanner\";\nimport { e as PathExitQr } from \"../../../../../../../chunks/paths.js\";\nimport { a as redirector } from \"../../../../../../../chunks/auth.js\";\nimport { p as page } from \"../../../../../../../chunks/stores.js\";\nimport \"html5-qrcode\";\nimport { b as beforeNavigate } from \"../../../../../../../chunks/navigation.js\";\nconst QrOperation = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  createEventDispatcher();\n  let { index } = $$props;\n  let { operation } = $$props;\n  if ($$props.index === void 0 && $$bindings.index && index !== void 0)\n    $$bindings.index(index);\n  if ($$props.operation === void 0 && $$bindings.operation && operation !== void 0)\n    $$bindings.operation(operation);\n  return `<div class=\"col-xxl-3 col-xl-4 col-lg-5 col-sm-6 col-xs-12\"><div class=\"card p-3 py-2\" role=\"button\"><div class=\"row g-0\"><div class=\"card-body text-center\">${operation?.status == \"loading\" ? `<div class=\"row align-items-center justify-content-center\" data-svelte-h=\"svelte-uu6jvq\"><div class=\"spinner-border text-primary\" role=\"status\"><span class=\"sr-only\">Loading...</span></div></div>` : `${operation?.status == \"error\" ? `<i class=\"ri-error-warning-line text-danger fs-1 align-middle\"></i> <audio src=\"/assets/audio/fail.mp3\"></audio> ${!JSON.parse(sessionStorage.getItem(\"permissions\")).includes(\"queues.exit.simplified\") ? `${operation?.errors?.json ? `<p class=\"text-danger\">${escape(operation.errors.json[0])}</p>` : ``} ${operation?.errors?.student_id ? `<p class=\"text-danger\">${escape(operation.errors.student_id[0])}</p>` : ``} ${operation?.errors?.queue_student_id ? `<p class=\"text-danger\">${escape(operation.errors.queue_student_id[0])}</p>` : ``} ${operation?.errors?.queue_id ? `<p class=\"text-danger\">${escape(operation.errors.queue_id[0])}</p>` : ``}` : ``}` : `${operation?.status == \"success\" ? `<audio src=\"/assets/audio/success.wav\"></audio> <i class=\"ri-check-double-line text-success fs-1 align-middle\"></i>` : ``}`}`}</div></div></div></div>`;\n});\nconst Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  let $page, $$unsubscribe_page;\n  $$unsubscribe_page = subscribe(page, (value) => $page = value);\n  let camerasList = [];\n  let boxSize = 250;\n  let fps = 24;\n  let qrOutput = \"\";\n  let timeout = false;\n  let operations = [];\n  async function exitQueue(result) {\n    if (timeout)\n      return;\n    timeout = true;\n    setTimeout(\n      async () => {\n        timeout = false;\n      },\n      // await qrScanner.start()\n      1200\n    );\n    let newIndex = operations.push({ status: \"loading\" });\n    operations = operations;\n    let formData = new FormData();\n    formData.set(\"student_id\", result);\n    let res = await fetch(PathExitQr($page.params.canteenId), {\n      headers: {\n        Authorization: `${localStorage.getItem(\"SID\")}`\n      },\n      method: \"POST\",\n      body: formData\n    });\n    redirector(res);\n    res = await res.json();\n    if (res.status == \"success\") {\n      operations[newIndex - 1] = { status: \"success\" };\n    } else {\n      res.errors;\n      operations[newIndex - 1] = { status: \"error\", errors: res.errors };\n    }\n  }\n  function listenInput(event) {\n    let key = event.key;\n    if (key === \"\\n\" || key === \"\\r\" || key == \"Enter\") {\n      exitQueue(qrOutput);\n      qrOutput = \"\";\n    } else {\n      qrOutput += key;\n    }\n  }\n  beforeNavigate(() => {\n    document.removeEventListener(\"keydown\", globalThis.listenInput);\n  });\n  document.addEventListener(\"keydown\", listenInput);\n  $$unsubscribe_page();\n  return `${JSON.parse(sessionStorage.getItem(\"permissions\")).includes(\"queues.exit\") ? `<div class=\"row\"><div class=\"col-lg-12\"><div class=\"card\"><div class=\"card-header align-items-center d-flex flex-wrap\"><h4 class=\"card-title mb-2 flex-grow-1\">Queue QR exit \n                        ${`<span class=\"badge bg-secondary\" data-svelte-h=\"svelte-1wrxaq2\">Using the External Scanner</span>`}</h4> <div class=\"flex-shrink-0\">   <button type=\"button\" data-bs-toggle=\"modal\" data-bs-target=\"#QrSettings\" class=\"btn btn-light btn-icon waves-effect me-2\" data-svelte-h=\"svelte-1m3cmxo\"><i class=\"ri-settings-4-line fs-4\"></i></button> ${`<button type=\"button\" class=\"btn btn-primary waves-effect waves-light\" data-svelte-h=\"svelte-1rledf1\">Launch Qr Scanner</button>`} </div> </div> ${`<input type=\"text\" name=\"firstname\" class=\"form-control\" id=\"firstName\"${add_attribute(\"value\", qrOutput, 0)}>`} ${``} </div></div>   <div class=\"row mt-4\">${each(operations, (operation, index) => {\n    return `${validate_component(QrOperation, \"QrOperation\").$$render($$result, { index, operation }, {}, {})}`;\n  })}</div> <div id=\"stream\" data-svelte-h=\"svelte-sfcnck\"></div>  </div>` : ``} <div class=\"modal fade\" id=\"QrSettings\" tabindex=\"-1\" aria-labelledby=\"exampleModalgridLabel\" aria-modal=\"true\"><div class=\"modal-dialog modal-dialog-centered\"><div class=\"modal-content\"><div class=\"modal-header\" data-svelte-h=\"svelte-15a0b33\"><h5 class=\"modal-title\" id=\"exampleModalgridLabel\">Qr Settings</h5> <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button></div> <div class=\"modal-body\"><div class=\"row g-3\"><div><label for=\"name\" class=\"form-label\" data-svelte-h=\"svelte-1gety4r\">Box Size</label> <input type=\"number\" class=\"form-control\" name=\"name\" id=\"firstName\"${add_attribute(\"value\", boxSize, 0)}></div> <div><label for=\"name\" class=\"form-label\" data-svelte-h=\"svelte-12m03yi\">Fps</label> <input type=\"number\" class=\"form-control\" name=\"name\" id=\"firstName\"${add_attribute(\"value\", fps, 0)}></div> <label for=\"class\" class=\"form-label\" data-svelte-h=\"svelte-1oi8tet\">Camera</label> <select class=\"form-select\" name=\"class\" id=\"class\" aria-label=\"Default select example\">${each(camerasList, (camera) => {\n    return `<option${add_attribute(\"value\", camera, 0)}>${escape(camera.label)}</option>`;\n  })}</select> <div class=\"hstack gap-2 justify-content-end\" data-svelte-h=\"svelte-zmnord\"><input type=\"submit\" class=\"btn btn-primary waves-effect waves-light\" data-bs-dismiss=\"modal\" value=\"Apply\"></div> </div></div></div></div></div>`;\n});\nexport {\n  Page as default\n};\n"],"names":[],"mappings":"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"}